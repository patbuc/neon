{"id":"neon-1j2","title":"ADR-000001: Impl Blocks","description":"Implement impl blocks for Neon structs, enabling instance methods (self), mutating methods (mut self), static methods, method chaining, and pub/private visibility.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-06T23:25:48.721465+01:00","created_by":"patricbucher","updated_at":"2026-01-06T23:25:48.721465+01:00"}
{"id":"neon-1j2.1","title":"Add lexer support for new keywords","description":"Add lexer support for impl, pub, mut, and self keywords.\n\n## Files to Modify\n- src/compiler/token.rs: Add TokenType variants (Impl, Pub, Mut, SelfKeyword)\n- src/compiler/scanner.rs: Update make_identifier_type() to recognize new keywords\n\n## Implementation Details\n- Add TokenType::Impl variant to the TokenType enum\n- Add TokenType::Pub variant to the TokenType enum\n- Add TokenType::Mut variant to the TokenType enum\n- Add TokenType::SelfKeyword variant to the TokenType enum\n- Update make_identifier_type() in scanner to recognize impl keyword\n- Update make_identifier_type() in scanner to recognize pub keyword\n- Update make_identifier_type() in scanner to recognize mut keyword\n- Update make_identifier_type() in scanner to recognize self keyword\n\n## Tests\n- Add unit tests for scanning all new keywords in src/compiler/tests/scanner.rs","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T23:25:55.129755+01:00","created_by":"patricbucher","updated_at":"2026-01-06T23:31:10.515143+01:00","closed_at":"2026-01-06T23:31:10.515143+01:00","close_reason":"Closed","dependencies":[{"issue_id":"neon-1j2.1","depends_on_id":"neon-1j2","type":"parent-child","created_at":"2026-01-06T23:25:55.130644+01:00","created_by":"patricbucher"}]}
{"id":"neon-1j2.10","title":"Update error messages and documentation","description":"Add error variants and improve error messages for impl block errors.\n\n## Files to Modify\n- src/common/errors.rs: Add new error variants\n- src/common/error_renderer.rs: Add error formatting for new errors\n\n## Implementation Details\n- Add new error variants:\n  - ImplForUndefinedStruct\n  - DuplicateImplBlock\n  - DuplicateMethodName\n  - PrivateMethodAccess\n  - SelfInStaticMethod\n  - MutationInNonMutMethod\n  - StaticMethodOnInstance\n- Add helpful error messages with suggestions\n- Update error renderer to format new errors nicely\n\n## Tests\n- Test error message output for each new error type","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-06T23:26:57.522839+01:00","created_by":"patricbucher","updated_at":"2026-01-06T23:26:57.522839+01:00","dependencies":[{"issue_id":"neon-1j2.10","depends_on_id":"neon-1j2","type":"parent-child","created_at":"2026-01-06T23:26:57.523809+01:00","created_by":"patricbucher"},{"issue_id":"neon-1j2.10","depends_on_id":"neon-1j2.5","type":"blocks","created_at":"2026-01-06T23:27:05.922896+01:00","created_by":"patricbucher"},{"issue_id":"neon-1j2.10","depends_on_id":"neon-1j2.8","type":"blocks","created_at":"2026-01-06T23:27:06.023594+01:00","created_by":"patricbucher"}]}
{"id":"neon-1j2.2","title":"Extend AST for impl blocks and methods","description":"Add AST nodes for impl blocks and method declarations.\n\n## Files to Modify\n- src/compiler/ast/mod.rs: Add Stmt::Impl variant and MethodDecl struct\n\n## Implementation Details\n- Add Stmt::Impl variant with struct_name, methods, and location fields\n- Add MethodDecl struct with name, params, body, is_public, is_mutating, is_static, location fields\n- Implement Display trait for new AST nodes\n\n## Tests\n- Add unit tests for AST construction in src/compiler/tests/ast.rs","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T23:25:59.511747+01:00","created_by":"patricbucher","updated_at":"2026-01-06T23:32:52.455446+01:00","closed_at":"2026-01-06T23:32:52.455446+01:00","close_reason":"Closed","dependencies":[{"issue_id":"neon-1j2.2","depends_on_id":"neon-1j2","type":"parent-child","created_at":"2026-01-06T23:25:59.512409+01:00","created_by":"patricbucher"}]}
{"id":"neon-1j2.3","title":"Implement parser for impl blocks","description":"Add parser support for impl blocks and method declarations.\n\n## Files to Modify\n- src/compiler/parser.rs: Add impl_declaration() and method_declaration() methods\n\n## Implementation Details\n- Add impl_declaration() method to parse impl blocks:\n  - Consume impl keyword\n  - Parse struct name identifier\n  - Consume {\n  - Parse methods until }\n  - Return Stmt::Impl\n- Add method_declaration() method to parse individual methods:\n  - Check for optional pub keyword\n  - Consume fn keyword\n  - Parse method name\n  - Parse parameter list, detecting self/mut self\n  - Parse body\n  - Return MethodDecl\n- Add branch in declaration() for TokenType::Impl\n\n## Tests\n- Basic impl block with single method\n- Multiple methods in impl block\n- Instance method with self\n- Mutating method with mut self\n- Static method without self\n- Public method with pub\n- Error cases (impl without struct name, missing braces, etc.)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T23:26:04.139963+01:00","created_by":"patricbucher","updated_at":"2026-01-06T23:38:00.626575+01:00","closed_at":"2026-01-06T23:38:00.626575+01:00","close_reason":"Closed","dependencies":[{"issue_id":"neon-1j2.3","depends_on_id":"neon-1j2","type":"parent-child","created_at":"2026-01-06T23:26:04.140944+01:00","created_by":"patricbucher"},{"issue_id":"neon-1j2.3","depends_on_id":"neon-1j2.1","type":"blocks","created_at":"2026-01-06T23:27:01.830075+01:00","created_by":"patricbucher"},{"issue_id":"neon-1j2.3","depends_on_id":"neon-1j2.2","type":"blocks","created_at":"2026-01-06T23:27:01.934671+01:00","created_by":"patricbucher"}]}
{"id":"neon-1j2.4","title":"Extend symbol table for method tracking","description":"Extend the symbol table to track methods on structs.\n\n## Files to Modify\n- src/compiler/symbol_table.rs: Extend SymbolKind::Struct and add MethodSignature\n\n## Implementation Details\n- Extend SymbolKind::Struct to include methods HashMap\u003cString, MethodSignature\u003e\n- Add MethodSignature struct with arity (u8), is_public (bool), is_mutating (bool), is_static (bool)\n- Add method to register methods on a struct symbol\n- Add method to look up method signatures by struct name and method name\n\n## Tests\n- Add unit tests for symbol table method tracking in src/compiler/tests/symbol_table.rs","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T23:26:10.102915+01:00","created_by":"patricbucher","updated_at":"2026-01-06T23:40:44.527396+01:00","closed_at":"2026-01-06T23:40:44.527396+01:00","close_reason":"Symbol table extended with MethodSignature, register_method(), lookup_method(), and 14 tests","dependencies":[{"issue_id":"neon-1j2.4","depends_on_id":"neon-1j2","type":"parent-child","created_at":"2026-01-06T23:26:10.103601+01:00","created_by":"patricbucher"},{"issue_id":"neon-1j2.4","depends_on_id":"neon-1j2.2","type":"blocks","created_at":"2026-01-06T23:27:02.429076+01:00","created_by":"patricbucher"}]}
{"id":"neon-1j2.5","title":"Implement semantic analysis for impl blocks","description":"Add semantic analysis for impl blocks including validation and method registration.\n\n## Files to Modify\n- src/compiler/semantic.rs: Handle Stmt::Impl and add analyze_impl() method\n\n## Implementation Details\n- Handle Stmt::Impl in collect_declarations():\n  - Verify struct exists and was declared before impl block\n  - Verify no duplicate impl blocks for same struct\n  - Register all methods on the struct symbol\n- Add analyze_impl() method:\n  - For each method, create a new scope\n  - If not static, define self as an implicit parameter\n  - Analyze method body\n  - Validate self usage matches declaration (mut vs immutable)\n- Update method call validation to check user-defined methods:\n  - Check struct's methods in addition to native methods\n  - Validate arity (accounting for implicit self)\n  - Check visibility (private methods only callable from same impl)\n\n## Tests\n- Valid impl blocks\n- Error: impl for undefined struct\n- Error: duplicate impl blocks\n- Error: duplicate method names\n- Error: calling private method from outside\n- Error: mutating self in non-mut method","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T23:26:20.046865+01:00","created_by":"patricbucher","updated_at":"2026-01-06T23:47:43.642156+01:00","closed_at":"2026-01-06T23:47:43.642156+01:00","close_reason":"Semantic analysis implemented with struct validation, duplicate impl prevention, method registration, and 10 tests","dependencies":[{"issue_id":"neon-1j2.5","depends_on_id":"neon-1j2","type":"parent-child","created_at":"2026-01-06T23:26:20.047749+01:00","created_by":"patricbucher"},{"issue_id":"neon-1j2.5","depends_on_id":"neon-1j2.3","type":"blocks","created_at":"2026-01-06T23:27:02.985362+01:00","created_by":"patricbucher"},{"issue_id":"neon-1j2.5","depends_on_id":"neon-1j2.4","type":"blocks","created_at":"2026-01-06T23:27:03.088628+01:00","created_by":"patricbucher"}]}
{"id":"neon-1j2.6","title":"Extend runtime types for methods","description":"Add runtime types for methods and bound methods.\n\n## Files to Modify\n- src/common/mod.rs: Extend ObjStruct and add ObjMethod, ObjBoundMethod\n\n## Implementation Details\n- Extend ObjStruct to include methods HashMap\u003cString, Rc\u003cObjMethod\u003e\u003e\n- Add ObjMethod struct with name, arity, chunk, is_public, is_mutating, is_static fields\n- Add ObjBoundMethod struct with receiver (Rc\u003cRefCell\u003cObjInstance\u003e\u003e) and method (Rc\u003cObjMethod\u003e)\n- Add Object::Method and Object::BoundMethod variants to Object enum\n- Add Value::new_method() and Value::new_bound_method() constructors\n- Update Value display/debug implementations\n\n## Tests\n- Unit tests for new Value types","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T23:26:26.249741+01:00","created_by":"patricbucher","updated_at":"2026-01-06T23:36:01.226671+01:00","closed_at":"2026-01-06T23:36:01.226671+01:00","close_reason":"Closed","dependencies":[{"issue_id":"neon-1j2.6","depends_on_id":"neon-1j2","type":"parent-child","created_at":"2026-01-06T23:26:26.250461+01:00","created_by":"patricbucher"}]}
{"id":"neon-1j2.7","title":"Implement code generation for impl blocks","description":"Add code generation for impl blocks and methods.\n\n## Files to Modify\n- src/compiler/codegen.rs: Handle Stmt::Impl and add generate_method()\n- src/common/opcodes.rs: Add OpCode::AttachMethod\n\n## Implementation Details\n- Handle Stmt::Impl in main codegen match:\n  - Look up the struct's local/global index\n  - For each method, generate method code\n  - Attach methods to the struct value\n- Add generate_method() function:\n  - Create new Chunk for method body\n  - If not static, add self as parameter 0\n  - Compile method body into chunk\n  - For mutating methods without explicit return, add implicit return self\n  - Create ObjMethod value\n- Update struct code generation to initialize empty methods HashMap\n- Add new opcode OpCode::AttachMethod to attach method to struct at runtime\n\n## Tests\n- Add codegen tests for method compilation in src/compiler/tests/codegen.rs","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T23:26:33.928886+01:00","created_by":"patricbucher","updated_at":"2026-01-06T23:54:58.586094+01:00","closed_at":"2026-01-06T23:54:58.586094+01:00","close_reason":"Closed","dependencies":[{"issue_id":"neon-1j2.7","depends_on_id":"neon-1j2","type":"parent-child","created_at":"2026-01-06T23:26:33.929545+01:00","created_by":"patricbucher"},{"issue_id":"neon-1j2.7","depends_on_id":"neon-1j2.3","type":"blocks","created_at":"2026-01-06T23:27:03.906408+01:00","created_by":"patricbucher"},{"issue_id":"neon-1j2.7","depends_on_id":"neon-1j2.6","type":"blocks","created_at":"2026-01-06T23:27:04.00971+01:00","created_by":"patricbucher"}]}
{"id":"neon-1j2.8","title":"Implement VM method dispatch","description":"Add VM support for method dispatch and bound method calls.\n\n## Files to Modify\n- src/vm/functions.rs: Update fn_get_field() and fn_call() for method dispatch\n- src/vm/impl.rs: Add OpCode::AttachMethod handler\n- src/common/opcodes.rs: Add OpCode::AttachMethod (if not done in task 7)\n\n## Implementation Details\n- Add OpCode::AttachMethod handler in VM:\n  - Pop method value and struct value from stack\n  - Insert method into struct's methods HashMap\n- Update fn_get_field() to check for methods:\n  - If field not found on instance, check instance.struct.methods\n  - If method found, create ObjBoundMethod and push to stack\n  - If static method accessed on instance, return error\n- Add handling for static method access on struct type:\n  - When GetField on a struct value (not instance), look up static methods\n- Update fn_call() to handle bound methods:\n  - Extract receiver and method from ObjBoundMethod\n  - Push receiver as first argument (self)\n  - Call method like regular function\n- Add visibility checking:\n  - Track current struct context during execution\n  - Private methods only callable when context matches\n\n## Tests\n- Add VM tests for method dispatch in src/vm/tests/","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-06T23:26:43.039887+01:00","created_by":"patricbucher","updated_at":"2026-01-06T23:26:43.039887+01:00","dependencies":[{"issue_id":"neon-1j2.8","depends_on_id":"neon-1j2","type":"parent-child","created_at":"2026-01-06T23:26:43.040593+01:00","created_by":"patricbucher"},{"issue_id":"neon-1j2.8","depends_on_id":"neon-1j2.6","type":"blocks","created_at":"2026-01-06T23:27:04.632128+01:00","created_by":"patricbucher"},{"issue_id":"neon-1j2.8","depends_on_id":"neon-1j2.7","type":"blocks","created_at":"2026-01-06T23:27:04.739619+01:00","created_by":"patricbucher"}]}
{"id":"neon-1j2.9","title":"Add integration tests for impl blocks","description":"Add comprehensive integration tests for impl blocks feature.\n\n## Files to Modify\n- tests/scripts/impl_basic.n: Basic instance method tests\n- tests/scripts/impl_mutating.n: Mutating method and chaining tests\n- tests/scripts/impl_static.n: Static method tests\n- tests/scripts/impl_visibility.n: Visibility tests\n- tests/scripts/impl_comprehensive.n: Full feature integration test\n- tests/neon_scripts.rs: Register new test files\n\n## Implementation Details\n- Create impl_basic.n:\n  - Basic instance method with self\n  - Method calling other methods\n  - Field access via self\n- Create impl_mutating.n:\n  - Mutating method modifying fields\n  - Method chaining with mut self\n  - Implicit self return\n- Create impl_static.n:\n  - Static factory methods\n  - Static utility methods\n  - Calling static method on type\n- Create impl_visibility.n:\n  - Public method access from outside\n  - Private method called internally\n- Create impl_comprehensive.n:\n  - Complex example combining all features\n  - Multiple structs with impl blocks\n  - Methods calling methods on other structs\n- Register all new test files in tests/neon_scripts.rs\n\n## Tests\n- All integration test files should pass","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-06T23:26:51.314575+01:00","created_by":"patricbucher","updated_at":"2026-01-06T23:26:51.314575+01:00","dependencies":[{"issue_id":"neon-1j2.9","depends_on_id":"neon-1j2","type":"parent-child","created_at":"2026-01-06T23:26:51.315301+01:00","created_by":"patricbucher"},{"issue_id":"neon-1j2.9","depends_on_id":"neon-1j2.8","type":"blocks","created_at":"2026-01-06T23:27:05.125735+01:00","created_by":"patricbucher"}]}
{"id":"neon-hoy","title":"Epic: Impl Blocks for Struct Methods","description":"Add Rust-style impl blocks allowing users to define associated functions (methods) for structs. Includes instance methods with explicit self, mutable methods with mut self, static methods, and implicit self return for method chaining. See docs/adr/001-impl-blocks.md for full design.","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2026-01-06T23:06:37.686616+01:00","created_by":"patricbucher","updated_at":"2026-01-06T23:33:05.536198+01:00","deleted_at":"2026-01-06T23:33:05.536198+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"neon-hoy.1","title":"Task 1: Scanner - Add impl and mut tokens","description":"Add new token types to the lexer for impl blocks:\n\n## Files to Modify\n- src/compiler/token.rs: Add Impl and Mut variants to TokenType enum\n- src/compiler/scanner.rs: Add keyword recognition in make_identifier_type()\n\n## Implementation Details\n- Add `Impl` variant to `TokenType` enum in token.rs\n- Add `Mut` variant to `TokenType` enum in token.rs\n- Add keyword recognition for `impl` in make_identifier_type() (handle 'i' -\u003e 'm' -\u003e \"pl\")\n- Add keyword recognition for `mut` in make_identifier_type() (handle 'm' -\u003e 'u' -\u003e \"t\")\n\n## Tests\n- Add unit tests in src/compiler/tests/scanner.rs for tokenizing impl and mut keywords","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T23:06:43.248291+01:00","created_by":"patricbucher","updated_at":"2026-01-06T23:33:05.536198+01:00","deleted_at":"2026-01-06T23:33:05.536198+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"neon-hoy.2","title":"Task 2: AST - Add Stmt::Impl variant","description":"Extend the AST to support impl blocks:\n\n## Files to Modify\n- src/compiler/ast/mod.rs: Add new Stmt variant and update location() method\n\n## Implementation Details\n- Add `Stmt::Impl` variant with fields: `struct_name: String`, `methods: Vec\u003cStmt\u003e`, `location: SourceLocation`\n- Update `Stmt::location()` method to handle the new `Impl` variant\n\n## Tests\n- Add unit tests in src/compiler/tests/ast.rs for new AST node","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T23:06:47.955852+01:00","created_by":"patricbucher","updated_at":"2026-01-06T23:33:05.536198+01:00","deleted_at":"2026-01-06T23:33:05.536198+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"neon-hoy.3","title":"Task 3: Parser - Parse impl blocks","description":"Add parsing support for impl blocks:\n\n## Files to Modify\n- src/compiler/parser.rs: Add impl_declaration() and update declaration()\n\n## Implementation Details\n- Add `else if self.match_token(TokenType::Impl)` case in `declaration()` method\n- Create `impl_declaration()` method that parses `impl StructName { fn ... }`\n- Modify `fn_declaration()` or create `method_declaration()` to parse `self`/`mut self` as first parameter\n- Add `TokenType::Impl` to synchronization in `synchronize()` method\n\n## Tests\n- Add unit tests in src/compiler/tests/parser.rs for parsing impl blocks\n- Test parsing instance methods with self\n- Test parsing mutating methods with mut self\n- Test parsing static methods (no self)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T23:06:52.754531+01:00","created_by":"patricbucher","updated_at":"2026-01-06T23:33:05.536198+01:00","deleted_at":"2026-01-06T23:33:05.536198+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"neon-hoy.4","title":"Task 4: Semantic Analysis - Method tracking and validation","description":"Add semantic analysis for impl blocks:\n\n## Files to Modify\n- src/compiler/semantic.rs: Add analyze_impl() and method validation\n- src/compiler/symbol_table.rs: Extend SymbolKind::Struct with methods\n\n## Implementation Details\n- Extend `SymbolKind::Struct` in symbol_table.rs to include `methods: HashMap\u003cString, MethodInfo\u003e` where MethodInfo contains arity and mutability\n- Add `analyze_impl()` method to `SemanticAnalyzer` to process impl blocks\n- Validate that impl block references an existing struct\n- Check for duplicate method definitions across all impl blocks for the same struct\n- Validate `self` usage: must be first parameter for instance methods\n- Validate mutability: only `mut self` methods can modify `self.field`\n- Track `self` as a special parameter with known type (the struct being implemented)\n\n## Tests\n- Add unit tests in src/compiler/tests/semantic.rs for impl validation\n- Test rejection of impl for non-existent struct\n- Test rejection of duplicate method names\n- Test rejection of field mutation in non-mut method","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T23:06:57.953688+01:00","created_by":"patricbucher","updated_at":"2026-01-06T23:33:05.536198+01:00","deleted_at":"2026-01-06T23:33:05.536198+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"neon-hoy.5","title":"Task 5: Runtime Structures - Extend ObjStruct and add opcodes","description":"Extend runtime structures for method support:\n\n## Files to Modify\n- src/common/mod.rs: Extend ObjStruct with methods field\n- src/common/opcodes.rs: Add Invoke and InvokeStatic opcode families\n- src/common/chunk/disassembler.rs: Handle new opcodes\n\n## Implementation Details\n- Extend `ObjStruct` in mod.rs to add `methods: HashMap\u003cString, Rc\u003cObjFunction\u003e\u003e` field\n- Update `Value::new_struct()` constructor to initialize empty methods HashMap\n- Add `Invoke`, `Invoke2`, `Invoke4` opcodes to `OpCode` enum in opcodes.rs\n- Add `InvokeStatic`, `InvokeStatic2`, `InvokeStatic4` opcodes to `OpCode` enum\n- Update disassembler in src/common/chunk/disassembler.rs to handle new opcodes\n\n## Tests\n- Verify opcodes are defined correctly\n- Verify disassembler outputs readable format for new opcodes","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T23:07:03.988264+01:00","created_by":"patricbucher","updated_at":"2026-01-06T23:33:05.536198+01:00","deleted_at":"2026-01-06T23:33:05.536198+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"neon-hoy.6","title":"Task 6: Code Generation - Compile impl blocks","description":"Add code generation for impl blocks:\n\n## Files to Modify\n- src/compiler/codegen.rs: Handle Stmt::Impl and method call generation\n\n## Implementation Details\n- Add `Stmt::Impl` case in `generate_stmt()` method\n- Create `generate_impl()` method to compile impl blocks\n- Compile each method as a function, storing on the struct's method table\n- Handle `self` as first parameter slot (local variable at index 0)\n- Handle `mut self` flag to enable implicit self return\n- Modify method call codegen: generate `Invoke` for `instance.method()` calls\n- Generate `InvokeStatic` for `Type.method()` calls (struct name followed by dot)\n- Implement implicit self return for `mut self` methods without explicit return\n\n## Tests\n- Add unit tests in src/compiler/tests/codegen.rs for impl compilation\n- Test bytecode generation for instance method definitions\n- Test Invoke opcode generation for method calls\n- Test InvokeStatic generation for static method calls","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T23:07:09.287173+01:00","created_by":"patricbucher","updated_at":"2026-01-06T23:33:05.536198+01:00","deleted_at":"2026-01-06T23:33:05.536198+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"neon-hoy.7","title":"Task 7: VM Execution - Method dispatch","description":"Implement VM method dispatch:\n\n## Files to Modify\n- src/vm/impl.rs: Add opcode handling in main execution loop\n- src/vm/functions.rs: Implement fn_invoke() and fn_invoke_static()\n\n## Implementation Details\n- Implement `fn_invoke()` in functions.rs: lookup method on receiver's struct type, push receiver as first arg, call\n- Implement `fn_invoke_static()` in functions.rs: lookup static method on named struct type, call without receiver\n- Add `OpCode::Invoke*` handling in the main execution loop in impl.rs\n- Add `OpCode::InvokeStatic*` handling in the main execution loop\n- Add method-not-found error messages with typo suggestions using existing `string_similarity.rs`\n\n## Tests\n- Add unit tests in src/vm/tests/basic.rs for method execution\n- Test instance method invocation\n- Test static method invocation\n- Test error messages for undefined methods","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T23:07:14.967822+01:00","created_by":"patricbucher","updated_at":"2026-01-06T23:33:05.536198+01:00","deleted_at":"2026-01-06T23:33:05.536198+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"neon-hoy.8","title":"Task 8: Testing - Comprehensive test scripts","description":"Create comprehensive integration tests:\n\n## Files to Create\n- tests/scripts/impl_basic.n: Basic instance method calls\n- tests/scripts/impl_static.n: Static method calls\n- tests/scripts/impl_mut_self.n: Mutating methods with mut self\n- tests/scripts/impl_chaining.n: Method chaining with implicit self return\n- tests/scripts/impl_multiple.n: Multiple impl blocks for same struct\n- tests/scripts/impl_with_structs.n: Methods interacting with other structs\n\n## Implementation Details\n- Create `tests/scripts/impl_basic.n`: basic instance method that accesses fields and returns computed value\n- Create `tests/scripts/impl_static.n`: static factory method that creates and returns new instance\n- Create `tests/scripts/impl_mut_self.n`: mutating method that modifies fields, verifies changes persist\n- Create `tests/scripts/impl_chaining.n`: chain of mutating methods with implicit self return\n- Create `tests/scripts/impl_multiple.n`: methods split across multiple impl blocks for same struct\n- Create `tests/scripts/impl_with_structs.n`: method that takes another struct as parameter\n- Verify all tests pass via `cargo test`\n\n## Tests\n- All scripts should have // Expected: comments with expected output\n- Run full test suite to ensure no regressions","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-06T23:07:20.804237+01:00","created_by":"patricbucher","updated_at":"2026-01-06T23:33:05.536198+01:00","deleted_at":"2026-01-06T23:33:05.536198+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"neon-hoy.9","title":"Task 9: Documentation - Update docs","description":"Update documentation with impl block feature:\n\n## Files to Modify\n- CLAUDE.md: Add impl block syntax guidance and examples\n- README.md: Add impl block feature description and examples\n\n## Implementation Details\n- Update `CLAUDE.md` with impl block syntax guidance and examples\n- Update `README.md` with impl block feature description and examples\n- Add examples showing instance methods, static methods, and method chaining\n\n## Tests\n- Review documentation for accuracy\n- Ensure code examples are correct and runnable","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-06T23:07:28.326821+01:00","created_by":"patricbucher","updated_at":"2026-01-06T23:33:05.536198+01:00","deleted_at":"2026-01-06T23:33:05.536198+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"neon-nks","title":"ADR-000001: Impl Blocks for Struct Methods","description":"Add Rust-style impl blocks that allow defining methods on structs, including instance methods (self), mutating methods (mut self), and static methods. See docs/adr/000001-impl-blocks-for-struct-methods.md for full specification.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-07T23:33:35.775176+01:00","created_by":"patricbucher","updated_at":"2026-01-07T23:33:35.775176+01:00"}
{"id":"neon-nks.1","title":"Add Impl token and scanning","description":"Add the `impl` keyword token to the scanner.\n\n## Files to Modify\n- `src/compiler/token.rs`: Add `Impl` variant to `TokenType` enum\n- `src/compiler/scanner.rs`: Add \"impl\" keyword mapping in keyword detection\n\n## Implementation Details\n- Add `Impl` variant to the `TokenType` enum alongside other keywords\n- Add \"impl\" to the keyword HashMap in the scanner (likely in `identifier_type()` or similar)\n\n## Tests\n- Add unit test verifying `impl` is scanned as `TokenType::Impl`\n- Add test in `src/compiler/tests/scanner.rs`","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T23:33:43.353763+01:00","created_by":"patricbucher","updated_at":"2026-01-07T23:51:26.47458+01:00","closed_at":"2026-01-07T23:51:26.47458+01:00","close_reason":"Closed","dependencies":[{"issue_id":"neon-nks.1","depends_on_id":"neon-nks","type":"parent-child","created_at":"2026-01-07T23:33:43.354738+01:00","created_by":"patricbucher"}]}
{"id":"neon-nks.2","title":"Extend AST for impl blocks","description":"Add AST nodes for impl blocks and method definitions.\n\n## Files to Modify\n- `src/compiler/ast/mod.rs`: Add new AST types\n\n## Implementation Details\nAdd the following types:\n\n```rust\n// New statement variant\nStmt::Impl {\n    struct_name: String,\n    methods: Vec\u003cImplMethod\u003e,\n    location: SourceLocation,\n}\n\n// New struct for method definitions\npub struct ImplMethod {\n    pub name: String,\n    pub params: Vec\u003cFunctionParam\u003e,  // includes self/mut self as first param, or empty for static\n    pub body: Vec\u003cStmt\u003e,\n    pub is_static: bool,             // true if no self parameter\n    pub is_mutating: bool,           // true if mut self\n    pub location: SourceLocation,\n}\n\n// Reusable parameter struct\npub struct FunctionParam {\n    pub name: String,\n    pub is_mutable: bool,  // for mut self\n}\n```\n\n## Tests\n- AST construction tests in `src/compiler/tests/ast.rs`","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T23:33:50.265114+01:00","created_by":"patricbucher","updated_at":"2026-01-07T23:54:11.011145+01:00","closed_at":"2026-01-07T23:54:11.011145+01:00","close_reason":"Closed","dependencies":[{"issue_id":"neon-nks.2","depends_on_id":"neon-nks","type":"parent-child","created_at":"2026-01-07T23:33:50.265796+01:00","created_by":"patricbucher"}]}
{"id":"neon-nks.3","title":"Parse impl blocks","description":"Add parser support for impl block syntax.\n\n## Files to Modify\n- `src/compiler/parser.rs`: Add impl block parsing methods\n\n## Implementation Details\n\n### Add `impl_block()` method:\n- Consume `impl` keyword (already matched in `declaration()`)\n- Parse struct name identifier\n- Consume `{`\n- Loop parsing methods until `}`\n- Return `Stmt::Impl`\n\n### Add `impl_method()` method:\n- Consume `fn` keyword\n- Parse method name identifier\n- Consume `(`\n- Check first parameter:\n  - If `mut self`: is_mutating=true, is_static=false\n  - If `self`: is_mutating=false, is_static=false\n  - Otherwise: is_static=true\n- Parse remaining parameters\n- Consume `)`\n- Parse method body (block)\n- Return `ImplMethod`\n\n### Integrate into `declaration()`:\n- Add case for `TokenType::Impl` that calls `impl_block()`\n\n## Tests\nAdd parser tests in `src/compiler/tests/parser.rs`:\n- Parse basic impl block with instance method\n- Parse impl block with mutating method\n- Parse impl block with static method\n- Parse impl block with multiple methods\n- Error: impl without struct name\n- Error: method without fn keyword","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T23:33:59.802692+01:00","created_by":"patricbucher","updated_at":"2026-01-08T00:00:36.599396+01:00","closed_at":"2026-01-08T00:00:36.599396+01:00","close_reason":"Closed","dependencies":[{"issue_id":"neon-nks.3","depends_on_id":"neon-nks","type":"parent-child","created_at":"2026-01-07T23:33:59.803393+01:00","created_by":"patricbucher"},{"issue_id":"neon-nks.3","depends_on_id":"neon-nks.1","type":"blocks","created_at":"2026-01-07T23:35:24.320782+01:00","created_by":"patricbucher"},{"issue_id":"neon-nks.3","depends_on_id":"neon-nks.2","type":"blocks","created_at":"2026-01-07T23:35:24.431191+01:00","created_by":"patricbucher"}]}
{"id":"neon-nks.4","title":"Extend symbol table for methods","description":"Extend the symbol table to track method signatures on struct symbols.\n\n## Files to Modify\n- `src/compiler/symbol_table.rs`: Extend SymbolKind::Struct and add MethodSignature\n\n## Implementation Details\n\n### Add MethodSignature struct:\n```rust\npub struct MethodSignature {\n    pub arity: u8,        // parameter count excluding self\n    pub is_static: bool,\n    pub is_mutating: bool,\n}\n```\n\n### Extend SymbolKind::Struct:\n```rust\nStruct {\n    fields: Vec\u003cString\u003e,\n    methods: HashMap\u003cString, MethodSignature\u003e,\n}\n```\n\n### Add helper methods:\n- `register_method(struct_name, method_name, signature)` - Add method to struct\n- `lookup_method(struct_name, method_name)` - Find method signature\n- Update any existing code that creates `SymbolKind::Struct` to include empty methods HashMap\n\n## Tests\n- Test method registration on struct symbol\n- Test method lookup\n- Test duplicate method detection","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T23:34:10.625062+01:00","created_by":"patricbucher","updated_at":"2026-01-08T00:03:43.880873+01:00","closed_at":"2026-01-08T00:03:43.880873+01:00","close_reason":"Closed","dependencies":[{"issue_id":"neon-nks.4","depends_on_id":"neon-nks","type":"parent-child","created_at":"2026-01-07T23:34:10.625842+01:00","created_by":"patricbucher"},{"issue_id":"neon-nks.4","depends_on_id":"neon-nks.2","type":"blocks","created_at":"2026-01-07T23:35:25.075012+01:00","created_by":"patricbucher"}]}
{"id":"neon-nks.5","title":"Semantic analysis for impl blocks","description":"Add semantic analysis for impl blocks including validation and self binding.\n\n## Files to Modify\n- `src/compiler/semantic.rs`: Handle Stmt::Impl in both passes\n\n## Implementation Details\n\n### Declaration Collection Pass:\n- Verify the struct exists in the symbol table\n- For each method in the impl block:\n  - Error if method name conflicts with a field name\n  - Error if duplicate method name in this impl block\n  - Register method signature in struct's symbol (using symbol_table helpers)\n\n### Analysis Pass:\n- For each method:\n  - Enter new scope for method body\n  - If not static: bind `self` as parameter\n    - For `mut self`: mark as mutable\n    - For `self`: mark as immutable\n  - Analyze method body statements\n  - Exit scope\n\n### Add error types to errors.rs (if needed):\n- \"Impl block for undefined struct 'X'\"\n- \"Method 'X' conflicts with field name\"\n- \"Duplicate method 'X' in impl block\"\n- \"Cannot assign to immutable self\"\n\n### Validation:\n- `self` field access should validate against struct's known fields\n- Assignment to `self.field` should error if `self` is not mutable\n\n## Tests\nAdd tests in `src/compiler/tests/semantic.rs`:\n- Valid impl block with all method types\n- Error: impl for undefined struct\n- Error: method name conflicts with field\n- Error: duplicate method names\n- Error: assignment to immutable self","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T23:34:20.056507+01:00","created_by":"patricbucher","updated_at":"2026-01-08T00:10:54.736825+01:00","closed_at":"2026-01-08T00:10:54.736825+01:00","close_reason":"Closed","dependencies":[{"issue_id":"neon-nks.5","depends_on_id":"neon-nks","type":"parent-child","created_at":"2026-01-07T23:34:20.057176+01:00","created_by":"patricbucher"},{"issue_id":"neon-nks.5","depends_on_id":"neon-nks.3","type":"blocks","created_at":"2026-01-07T23:35:25.702444+01:00","created_by":"patricbucher"},{"issue_id":"neon-nks.5","depends_on_id":"neon-nks.4","type":"blocks","created_at":"2026-01-07T23:35:25.809333+01:00","created_by":"patricbucher"}]}
{"id":"neon-nks.6","title":"Extend value system for struct methods","description":"Extend ObjStruct to store compiled methods.\n\n## Files to Modify\n- `src/common/mod.rs`: Extend ObjStruct and add helper methods\n\n## Implementation Details\n\n### Extend ObjStruct:\n```rust\npub struct ObjStruct {\n    pub name: String,\n    pub fields: Vec\u003cString\u003e,\n    pub methods: HashMap\u003cString, Rc\u003cObjFunction\u003e\u003e,  // NEW\n}\n```\n\n### Update Value::new_struct():\n- Initialize methods as empty HashMap\n\n### Add helper methods to ObjStruct:\n```rust\nimpl ObjStruct {\n    pub fn add_method(\u0026mut self, name: String, function: Rc\u003cObjFunction\u003e) {\n        self.methods.insert(name, function);\n    }\n    \n    pub fn get_method(\u0026self, name: \u0026str) -\u003e Option\u003c\u0026Rc\u003cObjFunction\u003e\u003e {\n        self.methods.get(name)\n    }\n}\n```\n\n### Note on mutability:\n- ObjStruct is wrapped in Rc, so to add methods we need interior mutability\n- Consider using `Rc\u003cRefCell\u003cObjStruct\u003e\u003e` or add methods at construction time\n- Alternative: make methods a `RefCell\u003cHashMap\u003c...\u003e\u003e` within ObjStruct\n\n## Tests\n- Test creating struct with methods\n- Test method lookup by name","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T23:34:33.871323+01:00","created_by":"patricbucher","updated_at":"2026-01-08T00:14:12.248274+01:00","closed_at":"2026-01-08T00:14:12.248274+01:00","close_reason":"Closed","dependencies":[{"issue_id":"neon-nks.6","depends_on_id":"neon-nks","type":"parent-child","created_at":"2026-01-07T23:34:33.87222+01:00","created_by":"patricbucher"}]}
{"id":"neon-nks.7","title":"Code generation for impl blocks","description":"Generate bytecode for impl blocks, compiling methods and attaching them to structs.\n\n## Files to Modify\n- `src/compiler/codegen.rs`: Handle Stmt::Impl and method compilation\n\n## Implementation Details\n\n### Handle Stmt::Impl in generate_stmt():\n1. Look up the struct's Value from locals (it was already compiled)\n2. For each method in the impl block:\n   - Compile method body as ObjFunction\n   - Add compiled function to struct's methods HashMap\n\n### Compile method bodies:\n- Create new chunk for method\n- For instance/mutating methods:\n  - `self` is slot 0 (first local)\n  - Mark as mutable if `mut self`\n- For static methods:\n  - No `self` binding\n- Compile method body statements\n- Emit Return opcode\n\n### Handle `self` in generate_variable_expr():\n- When inside an impl method context, `self` resolves to local slot 0\n- Need to track \"inside impl method\" state during codegen\n\n### State tracking:\nAdd fields to CodeGenerator:\n```rust\nstruct CodeGenerator {\n    // ... existing fields\n    in_impl_method: bool,\n    current_struct_name: Option\u003cString\u003e,\n}\n```\n\n### Struct mutability consideration:\n- Since structs are defined before impl blocks, we need to mutate the already-defined struct Value\n- May need to change how struct Values are stored (use RefCell for methods HashMap)\n\n## Tests\nAdd tests in `src/compiler/tests/codegen.rs`:\n- Compile impl block with instance method\n- Compile impl block with mutating method\n- Compile impl block with static method\n- Verify self is bound correctly","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T23:34:48.035551+01:00","created_by":"patricbucher","updated_at":"2026-01-08T00:21:28.429884+01:00","closed_at":"2026-01-08T00:21:28.429884+01:00","close_reason":"Closed","dependencies":[{"issue_id":"neon-nks.7","depends_on_id":"neon-nks","type":"parent-child","created_at":"2026-01-07T23:34:48.036246+01:00","created_by":"patricbucher"},{"issue_id":"neon-nks.7","depends_on_id":"neon-nks.3","type":"blocks","created_at":"2026-01-07T23:35:27.039385+01:00","created_by":"patricbucher"},{"issue_id":"neon-nks.7","depends_on_id":"neon-nks.6","type":"blocks","created_at":"2026-01-07T23:35:27.157267+01:00","created_by":"patricbucher"}]}
{"id":"neon-nks.8","title":"VM method dispatch for user-defined methods","description":"Update VM to dispatch calls to user-defined struct methods.\n\n## Files to Modify\n- `src/vm/impl.rs`: Update call handling\n- `src/vm/functions.rs`: Add method lookup and dispatch\n\n## Implementation Details\n\n### Instance method dispatch:\nWhen handling a method call on an instance (`instance.method(args)`):\n1. Get the instance's struct type: `instance.struct`\n2. Look up method in `struct.methods`\n3. If found:\n   - Push instance as first argument (receiver/self)\n   - Call the ObjFunction\n4. If not found:\n   - Fall back to native method lookup (existing behavior)\n\n### Static method dispatch:\nWhen `GetField` is called on a Struct value (not instance):\n1. Look up field name in `struct.methods`\n2. If found and method is static:\n   - Return the method as a callable value\n3. If not found or not static:\n   - Error: \"Undefined static method 'X' for struct 'Y'\"\n\n### Mutating methods:\n- For `mut self` methods, the receiver is `Rc\u003cRefCell\u003cObjInstance\u003e\u003e`\n- Mutations through `self.field = value` modify the original instance\n- This should work automatically since ObjInstance uses RefCell\n\n### Error handling:\nAdd runtime error: \"Undefined method 'X' for struct 'Y'\"\n\n### Call flow:\n```\np.distance(other)\n-\u003e GetField(p, \"distance\") -- but this is a method call, not field access\n-\u003e Actually: parser creates Call { callee: GetField { p, \"distance\" }, args: [other] }\n-\u003e Codegen emits NativeByName or similar\n-\u003e VM needs to check user-defined methods BEFORE native methods\n```\n\n## Tests\nAdd VM tests:\n- Call instance method\n- Call mutating method, verify mutation persists\n- Call static method via Type.method()\n- Error: call undefined method\n- Method on wrong type should fail","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T23:35:01.478503+01:00","created_by":"patricbucher","updated_at":"2026-01-08T17:28:52.839418+01:00","closed_at":"2026-01-08T17:28:52.839418+01:00","close_reason":"Closed","dependencies":[{"issue_id":"neon-nks.8","depends_on_id":"neon-nks","type":"parent-child","created_at":"2026-01-07T23:35:01.479376+01:00","created_by":"patricbucher"},{"issue_id":"neon-nks.8","depends_on_id":"neon-nks.6","type":"blocks","created_at":"2026-01-07T23:35:27.707732+01:00","created_by":"patricbucher"}]}
{"id":"neon-nks.9","title":"Integration tests for impl blocks","description":"Create comprehensive integration tests for the impl blocks feature.\n\n## Files to Modify\n- `tests/scripts/impl_basic.n`: NEW - Basic instance methods\n- `tests/scripts/impl_mutating.n`: NEW - Mutating methods\n- `tests/scripts/impl_static.n`: NEW - Static methods\n- `tests/scripts/impl_chaining.n`: NEW - Method chaining\n- `tests/scripts/impl_comprehensive.n`: NEW - Full feature integration\n- `tests/neon_scripts.rs`: Register new test files\n\n## Test Files\n\n### impl_basic.n\n- Instance methods with self\n- Field access via self (self.x, self.y)\n- Return values from methods\n- Multiple methods on same struct\n- Methods calling other methods\n\n### impl_mutating.n\n- Mutating methods with `mut self`\n- Field modification (self.x = value)\n- Verify mutations persist after method call\n- Error case: assign to immutable self (compile error)\n\n### impl_static.n\n- Static methods (no self parameter)\n- Factory pattern: Point.origin()\n- Static method calling constructor\n- Cannot call static method on instance\n\n### impl_chaining.n\n- Method chaining with explicit `return self`\n- Mixed instance and mutating calls\n- Builder pattern example\n\n### impl_comprehensive.n\n- Complex example with all features\n- Struct with both fields and methods\n- Methods interacting with other structs\n- Methods using arrays, maps, etc.\n- Multiple structs with impl blocks\n\n## Registration\nAdd test functions in `tests/neon_scripts.rs` for each new script file.","status":"in_progress","priority":3,"issue_type":"task","created_at":"2026-01-07T23:35:11.36382+01:00","created_by":"patricbucher","updated_at":"2026-01-08T17:28:52.972842+01:00","dependencies":[{"issue_id":"neon-nks.9","depends_on_id":"neon-nks","type":"parent-child","created_at":"2026-01-07T23:35:11.365668+01:00","created_by":"patricbucher"},{"issue_id":"neon-nks.9","depends_on_id":"neon-nks.8","type":"blocks","created_at":"2026-01-07T23:35:28.316348+01:00","created_by":"patricbucher"}]}
